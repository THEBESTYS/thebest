<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ìƒë‹´ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .score-item label {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .score-item input {
            text-align: center;
            font-weight: bold;
        }
        
        .total-score {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .data-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .data-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
        }
        
        .data-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .data-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .data-mbti {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .data-details {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .mbti-distribution {
            margin-top: 20px;
        }
        
        .mbti-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 4px solid #2ecc71;
        }
        
        .mbti-type {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .mbti-count {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            color: white;
            padding: 20px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        .system-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 14px;
            color: white;
        }
        
        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .info-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
        }
        
        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .info-label {
            font-weight: bold;
            opacity: 0.8;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .info-value {
            font-family: 'Courier New', monospace;
            word-break: break-all;
            font-size: 14px;
        }
        
        .qr-code {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .qr-title {
            margin-bottom: 10px;
            font-weight: bold;
        }
    </style>
    
    <!-- QR ì½”ë“œ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ MBTI ìƒë‹´ ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
            <p>êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ì›¹ì•± - ë°°í¬ ì™„ë£Œ</p>
        </div>
        
        <div class="status-message" id="statusMessage"></div>
        
        <div class="main-content">
            <!-- ì™¼ìª½: ì…ë ¥ í¼ -->
            <div class="card">
                <h2>ğŸ“ MBTI ë°ì´í„° ì…ë ¥</h2>
                <form id="mbtiForm">
                    <div class="form-group">
                        <label for="name">ì´ë¦„ *</label>
                        <input type="text" id="name" name="name" required placeholder="í™ê¸¸ë™">
                    </div>
                    
                    <div class="form-group">
                        <label for="mbtiType">MBTI ìœ í˜• *</label>
                        <select id="mbtiType" name="mbtiType" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ISTJ">ISTJ - ì²­ë ´ê²°ë°±í•œ ë…¼ë¦¬ì£¼ì˜ì</option>
                            <option value="ISFJ">ISFJ - ìš©ê°í•œ ìˆ˜í˜¸ì</option>
                            <option value="INFJ">INFJ - ì„ ì˜ì˜ ì˜¹í˜¸ì</option>
                            <option value="INTJ">INTJ - ì „ëµê°€</option>
                            <option value="ISTP">ISTP - ë§ŒëŠ¥ ì¬ì£¼ê¾¼</option>
                            <option value="ISFP">ISFP - í˜¸ê¸°ì‹¬ ë§ì€ ì˜ˆìˆ ê°€</option>
                            <option value="INFP">INFP - ì¤‘ì¬ì</option>
                            <option value="INTP">INTP - ë…¼ë¦¬ìˆ ì‚¬</option>
                            <option value="ESTP">ESTP - ëª¨í—˜ì„ ì¦ê¸°ëŠ” ì‚¬ì—…ê°€</option>
                            <option value="ESFP">ESFP - ììœ ë¡œìš´ ì˜í˜¼ì˜ ì—°ì˜ˆì¸</option>
                            <option value="ENFP">ENFP - ì¬ê¸°ë°œë„í•œ í™œë™ê°€</option>
                            <option value="ENTP">ENTP - ëœ¨ê±°ìš´ ë…¼ìŸì„ ì¦ê¸°ëŠ” ë³€ë¡ ê°€</option>
                            <option value="ESTJ">ESTJ - ì—„ê²©í•œ ê´€ë¦¬ì</option>
                            <option value="ESFJ">ESFJ - ì‚¬êµì ì¸ ì™¸êµê´€</option>
                            <option value="ENFJ">ENFJ - ì •ì˜ë¡œìš´ ì‚¬íšŒìš´ë™ê°€</option>
                            <option value="ENTJ">ENTJ - ëŒ€ë‹´í•œ í†µì†”ì</option>
                        </select>
                    </div>
                    
                    <div class="score-grid">
                        <div class="score-item">
                            <label>E-I ì ìˆ˜ (0-40)</label>
                            <input type="number" id="eiScore" name="eiScore" min="0" max="40" value="20" oninput="calculateTotal()">
                        </div>
                        <div class="score-item">
                            <label>S-N ì ìˆ˜ (0-40)</label>
                            <input type="number" id="snScore" name="snScore" min="0" max="40" value="20" oninput="calculateTotal()">
                        </div>
                        <div class="score-item">
                            <label>T-F ì ìˆ˜ (0-40)</label>
                            <input type="number" id="tfScore" name="tfScore" min="0" max="40" value="20" oninput="calculateTotal()">
                        </div>
                        <div class="score-item">
                            <label>J-P ì ìˆ˜ (0-40)</label>
                            <input type="number" id="jpScore" name="jpScore" min="0" max="40" value="20" oninput="calculateTotal()">
                        </div>
                    </div>
                    
                    <div class="total-score">
                        ì´ì : <span id="totalScore">80</span>ì 
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">íŠ¹ì´ì‚¬í•­</label>
                        <textarea id="notes" name="notes" rows="3" placeholder="ì„±ê²© íŠ¹ì§•, ê´€ì‹¬ì‚¬, ê´€ì°°ì‚¬í•­ ë“±ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="contact">ì—°ë½ì²˜</label>
                        <input type="text" id="contact" name="contact" placeholder="010-1234-5678">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">ì´ë©”ì¼</label>
                        <input type="email" id="email" name="email" placeholder="example@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="remarks">ì°¸ê³ ì‚¬í•­</label>
                        <textarea id="remarks" name="remarks" rows="2" placeholder="ìƒë‹´ í¬ë§ ì‹œê°„, íŠ¹ë³„ ìš”ì²­ì‚¬í•­ ë“±"></textarea>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">ì´ˆê¸°í™”</button>
                        <button type="submit" class="btn btn-primary">ë“±ë¡í•˜ê¸°</button>
                    </div>
                </form>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½: ë°ì´í„° ë° í†µê³„ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>ğŸ“Š ìµœê·¼ ë“±ë¡ í˜„í™©</h2>
                    <button class="btn btn-secondary" onclick="refreshData()" style="padding: 10px 20px;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                
                <div id="dataList" class="data-list">
                    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
                
                <div id="statsSection" style="margin-top: 30px;">
                    <h3>ğŸ“ˆ í†µê³„ ì •ë³´</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">ì´ ë“±ë¡ì</div>
                            <div class="stat-value" id="totalCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">í‰ê·  ì ìˆ˜</div>
                            <div class="stat-value" id="avgScore">0</div>
                        </div>
                    </div>
                    
                    <div class="mbti-distribution">
                        <h4 style="margin-bottom: 15px; color: #2c3e50;">MBTI ìœ í˜•ë³„ ë¶„í¬</h4>
                        <div id="mbtiDistribution">
                            <!-- MBTI ë¶„í¬ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ë°°í¬ ì •ë³´ ì„¹ì…˜ -->
        <div class="system-info">
            <div class="info-header">
                <div class="info-title">ğŸŒ ì‹œìŠ¤í…œ ë°°í¬ ì •ë³´</div>
                <button class="copy-btn" onclick="copyDeploymentInfo()">ì •ë³´ ë³µì‚¬</button>
            </div>
            
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">ë°°í¬ ID</div>
                    <div class="info-value" id="deploymentId">AKfycbzlONm9aOjPtT06U58sfOX3VWu3D-MT8QfFpOo8QWHbzuKqBR4kprHEeBODMEyCDartBg</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ì›¹ì•± URL</div>
                    <div class="info-value" id="webAppUrl">https://script.google.com/macros/s/AKfycbzlONm9aOjPtT06U58sfOX3VWu3D-MT8QfFpOo8QWHbzuKqBR4kprHEeBODMEyCDartBg/exec</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">êµ¬ê¸€ ì‹œíŠ¸ URL</div>
                    <div class="info-value" id="sheetUrl">https://docs.google.com/spreadsheets/d/1BM-gVV-Ci9Nt4YEnBDlz-2PE_Ad_-0uy5m-JDNw9KHc/edit?gid=0#gid=0</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ì‹œíŠ¸ ID</div>
                    <div class="info-value">1BM-gVV-Ci9Nt4YEnBDlz-2PE_Ad_-0uy5m-JDNw9KHc</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ì‹œíŠ¸ ì´ë¦„</div>
                    <div class="info-value">MBTIS</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">ë°°í¬ ìƒíƒœ</div>
                    <div class="info-value" style="color: #2ecc71; font-weight: bold;">âœ… ë°°í¬ ì™„ë£Œ</div>
                </div>
            </div>
            
            <div class="qr-code">
                <div class="qr-title">ğŸ“± ì›¹ì•± QR ì½”ë“œ (ëª¨ë°”ì¼ ì ‘ì†ìš©)</div>
                <div id="qrcode"></div>
                <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                    QR ì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì—¬ ëª¨ë°”ì¼ì—ì„œ ì ‘ì†í•˜ì„¸ìš”
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2024 MBTI ìƒë‹´ ê´€ë¦¬ ì‹œìŠ¤í…œ | êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ì›¹ì•±</p>
            <p style="font-size: 12px; margin-top: 5px;">ë°°í¬ ì™„ë£Œ: <span id="currentDate"></span></p>
        </div>
    </div>
    
    <script>
        // ë°°í¬ ì •ë³´ ìƒìˆ˜
        const DEPLOYMENT_CONFIG = {
            deploymentId: 'AKfycbzlONm9aOjPtT06U58sfOX3VWu3D-MT8QfFpOo8QWHbzuKqBR4kprHEeBODMEyCDartBg',
            webAppUrl: 'https://script.google.com/macros/s/AKfycbzlONm9aOjPtT06U58sfOX3VWu3D-MT8QfFpOo8QWHbzuKqBR4kprHEeBODMEyCDartBg/exec',
            sheetUrl: 'https://docs.google.com/spreadsheets/d/1BM-gVV-Ci9Nt4YEnBDlz-2PE_Ad_-0uy5m-JDNw9KHc/edit?gid=0#gid=0',
            sheetId: '1BM-gVV-Ci9Nt4YEnBDlz-2PE_Ad_-0uy5m-JDNw9KHc',
            sheetName: 'MBTIS'
        };
        
        // ì „ì—­ ë³€ìˆ˜
        let currentData = [];
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // í˜„ì¬ ë‚ ì§œ í‘œì‹œ
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            // QR ì½”ë“œ ìƒì„±
            generateQRCode();
            
            // ë°ì´í„° ë¡œë“œ
            loadData();
            calculateTotal();
            
            // ë°°í¬ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            setTimeout(() => {
                showMessage('âœ… ì›¹ì•±ì´ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }, 1000);
        });
        
        // QR ì½”ë“œ ìƒì„±
        function generateQRCode() {
            try {
                const qrcodeContainer = document.getElementById('qrcode');
                qrcodeContainer.innerHTML = '';
                
                QRCode.toCanvas(qrcodeContainer, DEPLOYMENT_CONFIG.webAppUrl, {
                    width: 150,
                    height: 150,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function(error) {
                    if (error) {
                        console.error('QR ì½”ë“œ ìƒì„± ì˜¤ë¥˜:', error);
                        qrcodeContainer.innerHTML = '<div style="color: white; padding: 20px;">QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨</div>';
                    }
                });
            } catch (error) {
                console.error('QR ì½”ë“œ ìƒì„± ì˜¤ë¥˜:', error);
            }
        }
        
        // ì´ì  ê³„ì‚°
        function calculateTotal() {
            const ei = parseInt(document.getElementById('eiScore').value) || 0;
            const sn = parseInt(document.getElementById('snScore').value) || 0;
            const tf = parseInt(document.getElementById('tfScore').value) || 0;
            const jp = parseInt(document.getElementById('jpScore').value) || 0;
            const total = ei + sn + tf + jp;
            document.getElementById('totalScore').textContent = total;
        }
        
        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('mbtiForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ìœ íš¨ì„± ê²€ì‚¬
            const name = document.getElementById('name').value.trim();
            const mbtiType = document.getElementById('mbtiType').value;
            
            if (!name || !mbtiType) {
                showMessage('ì´ë¦„ê³¼ MBTI ìœ í˜•ì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const formData = {
                name: name,
                mbtiType: mbtiType,
                eiScore: document.getElementById('eiScore').value,
                snScore: document.getElementById('snScore').value,
                tfScore: document.getElementById('tfScore').value,
                jpScore: document.getElementById('jpScore').value,
                notes: document.getElementById('notes').value.trim(),
                contact: document.getElementById('contact').value.trim(),
                email: document.getElementById('email').value.trim(),
                remarks: document.getElementById('remarks').value.trim(),
                action: 'submit'
            };
            
            // ë¡œë”© í‘œì‹œ
            showLoading(true);
            
            try {
                // ë°ì´í„° ì œì¶œ (í˜„ì¬ URL ì‚¬ìš©)
                const url = new URL(window.location.href);
                const params = new URLSearchParams();
                
                for (const key in formData) {
                    if (formData[key]) {
                        params.append(key, formData[key]);
                    }
                }
                
                const response = await fetch(url.toString(), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: params.toString()
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(result.message, 'success');
                    resetForm();
                    
                    // 1ì´ˆ í›„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        loadData();
                    }, 1000);
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                showMessage('ì„œë²„ ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                console.error('ì œì¶œ ì˜¤ë¥˜:', error);
            } finally {
                showLoading(false);
            }
        });
        
        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            showDataLoading(true);
            
            try {
                // ë°ì´í„° ì¡°íšŒ
                const url = new URL(window.location.href);
                url.searchParams.set('action', 'getData');
                
                const response = await fetch(url.toString());
                const result = await response.json();
                
                if (result.success) {
                    currentData = result.data;
                    displayData(currentData);
                    await loadStats();
                } else {
                    showMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + result.message, 'error');
                }
            } catch (error) {
                showMessage('ì„œë²„ ì—°ê²° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            } finally {
                showDataLoading(false);
            }
        }
        
        // í†µê³„ ë¡œë“œ
        async function loadStats() {
            try {
                const url = new URL(window.location.href);
                url.searchParams.set('action', 'getStats');
                
                const response = await fetch(url.toString());
                const result = await response.json();
                
                if (result.success) {
                    displayStats(result.stats);
                }
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë°ì´í„° í‘œì‹œ
        function displayData(data) {
            const container = document.getElementById('dataList');
            
            if (data.length === 0) {
                container.innerHTML = '<div class="data-item" style="text-align: center; color: #7f8c8d; padding: 30px;">ë“±ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë°ì´í„°ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</div>';
                return;
            }
            
            let html = '';
            data.forEach(item => {
                const date = new Date(item['ë“±ë¡ì¼ì']).toLocaleString('ko-KR');
                const totalScore = item['ì „ì²´ ì ìˆ˜'] || 0;
                const scoreColor = totalScore >= 120 ? '#2ecc71' : 
                                 totalScore >= 100 ? '#3498db' : 
                                 totalScore >= 80 ? '#f39c12' : '#e74c3c';
                
                html += `
                    <div class="data-item">
                        <div class="data-item-header">
                            <div class="data-name">${item['ì´ë¦„'] || 'ì´ë¦„ ì—†ìŒ'}</div>
                            <div class="data-mbti" style="background: ${scoreColor}">${item['MBTI ìœ í˜•'] || 'ë¯¸ì…ë ¥'}</div>
                        </div>
                        <div class="data-details">
                            <div><strong>ë“±ë¡ì¼:</strong> ${date}</div>
                            <div><strong>ì ìˆ˜:</strong> ì´ ${totalScore}ì  | E-I: ${item['E-I ì ìˆ˜'] || 0} | S-N: ${item['S-N ì ìˆ˜'] || 0} | T-F: ${item['T-F ì ìˆ˜'] || 0} | J-P: ${item['J-P ì ìˆ˜'] || 0}</div>
                            ${item['íŠ¹ì´ì‚¬í•­'] ? `<div><strong>íŠ¹ì´ì‚¬í•­:</strong> ${item['íŠ¹ì´ì‚¬í•­']}</div>` : ''}
                            ${item['ì—°ë½ì²˜'] ? `<div><strong>ì—°ë½ì²˜:</strong> ${item['ì—°ë½ì²˜']}</div>` : ''}
                            ${item['ì´ë©”ì¼'] ? `<div><strong>ì´ë©”ì¼:</strong> ${item['ì´ë©”ì¼']}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // í†µê³„ í‘œì‹œ
        function displayStats(stats) {
            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('avgScore').textContent = stats.avgScore;
            
            // MBTI ë¶„í¬ í‘œì‹œ
            const distributionContainer = document.getElementById('mbtiDistribution');
            if (Object.keys(stats.mbtiDistribution).length === 0) {
                distributionContainer.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            // MBTI ìœ í˜•ë³„ ì •ë ¬
            const sortedTypes = Object.entries(stats.mbtiDistribution)
                .sort((a, b) => b[1] - a[1]);
            
            let html = '';
            sortedTypes.forEach(([type, count]) => {
                const percentage = ((count / stats.total) * 100).toFixed(1);
                html += `
                    <div class="mbti-item">
                        <div class="mbti-type">${type}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="flex-grow: 1;">
                                <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden;">
                                    <div style="width: ${percentage}%; height: 100%; background: #3498db;"></div>
                                </div>
                            </div>
                            <div class="mbti-count">${count}ëª… (${percentage}%)</div>
                        </div>
                    </div>
                `;
            });
            
            distributionContainer.innerHTML = html;
        }
        
        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            document.getElementById('mbtiForm').reset();
            document.getElementById('totalScore').textContent = '80';
        }
        
        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        function refreshData() {
            loadData();
            showMessage('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            statusDiv.style.display = 'block';
            
            if (message && type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }
        
        // ë¡œë”© í‘œì‹œ (í¼)
        function showLoading(show) {
            const buttons = document.querySelectorAll('#mbtiForm button');
            buttons.forEach(button => {
                button.disabled = show;
            });
        }
        
        // ë¡œë”© í‘œì‹œ (ë°ì´í„°)
        function showDataLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('dataList').style.display = show ? 'none' : 'block';
            document.getElementById('statsSection').style.display = show ? 'none' : 'block';
        }
        
        // ë°°í¬ ì •ë³´ ë³µì‚¬
        function copyDeploymentInfo() {
            const info = `
ë°°í¬ ID: ${DEPLOYMENT_CONFIG.deploymentId}
ì›¹ì•± URL: ${DEPLOYMENT_CONFIG.webAppUrl}
êµ¬ê¸€ ì‹œíŠ¸: ${DEPLOYMENT_CONFIG.sheetUrl}
ì‹œíŠ¸ ID: ${DEPLOYMENT_CONFIG.sheetId}
ì‹œíŠ¸ ì´ë¦„: ${DEPLOYMENT_CONFIG.sheetName}
ë°°í¬ ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}
            `.trim();
            
            navigator.clipboard.writeText(info).then(() => {
                showMessage('âœ… ë°°í¬ ì •ë³´ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                showMessage('ë³µì‚¬ ì‹¤íŒ¨: ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”', 'error');
            });
        }
        
        // ë°°í¬ ì •ë³´ í…ŒìŠ¤íŠ¸
        function testDeployment() {
            const url = DEPLOYMENT_CONFIG.webAppUrl;
            const testWindow = window.open(url, '_blank');
            
            if (testWindow) {
                showMessage('ìƒˆ ì°½ì—ì„œ ì›¹ì•±ì„ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤...', 'success');
            } else {
                showMessage('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ URLì„ ì—´ì–´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        // ì›¹ì•± URL ì—´ê¸°
        function openWebApp() {
            window.open(DEPLOYMENT_CONFIG.webAppUrl, '_blank');
        }
        
        // ì‹œíŠ¸ URL ì—´ê¸°
        function openSheet() {
            window.open(DEPLOYMENT_CONFIG.sheetUrl, '_blank');
        }
        
        // ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸
        setInterval(loadData, 30000); // 30ì´ˆë§ˆë‹¤ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    </script>
</body>
</html>
